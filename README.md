# DeployBot

DeployBot is a chat bot built on the [Hubot][hubot] framework. It was
initially generated by [generator-hubot][generator-hubot], and configured to be
deployed on [AWS Elastic Beanstalk][elastic beanstalk] to get you up and running as quick as possible.

[elastic beanstalk]: https://aws.amazon.com/elasticbeanstalk
[hubot]: http://hubot.github.com
[generator-hubot]: https://github.com/github/generator-hubot
[hubot-slack]: https://github.com/slackhq/hubot-slack

### Important
DeployBot uses a downgraded version of the [hubot-slack][hubot-slack] client 3.4.2 (latest is 4.1.x)
due to [bug](https://github.com/slackhq/hubot-slack/issues/326)

### Setup

Go to your [Custom Integrations](https://www.slack.com/apps/manage/custom-integrations)
page for your Slack instance and set up a new Bot integration. Copy the API
token and save for later.

If running locally, set the following environment variables on your host directly.

- `HUBOT_SEMAPHOREAPP_DEPLOY` - Enter something non-zero to enable deployment commands
- `HUBOT_SEMAPHOREAPP_AUTH_TOKEN` - Enter your Semaphore authorization token
- `HUBOT_SLACK_TOKEN` - Enter your Slack token
- `HUBOT_AUTH_ADMIN` - Enter your comma separated list of admin user ids
- `REDIS_URL` - Enter your redis url

If running on a hosted service such as AWS Elastic Beanstalk, you can set the environment 
variables on your apps Software Configuration page.

### Run

Run `npm install` if you have just cloned the repo for the first time, to
install the required dependencies.

Run `run.sh` to start DeployBot.

### Usage

The bot will now join your Slack instance if you specified the correct API
token. You can invite the bot to whatever channel you want it to be present in.

DeployBot understands the following commands:

- `deploybot <user> has <role> role` - Assigns a role to a user
- `deploybot <user> doesn't have <role> role` - Removes a role from a user
- `deploybot brain show storage` - Display the contents that are persisted in the brain
- `deploybot brain show storage --key=[key]` - Display the contents that are persisted with specified key in the brain
- `deploybot brain show users` - Display all users that hubot knows about
- `deploybot deploy project` - deploys project/master to 'prod'
- `deploybot deploy project to server` - deploys project/master to server
- `deploybot deploy project/branch` - deploys project/branch to 'prod'
- `deploybot deploy project/branch to server` - deploys project/branch to server
- `deploybot deployed commit` - check if commit has been deployed to default server on default project
- `deploybot deployed commit on project` - check if commit has been deployed to default server on project
- `deploybot deployed commit on project to server` - check if commit has been deployed to server on project
- `deploybot deployed msg` - check if commit message has been deployed to default server on default project
- `deploybot deployed msg on project` - check if commit message has been deployed to default server on project
- `deploybot deployed msg on project to server` - check if commit message has been deployed to server on project
- `deploybot help` - Displays all of the help commands that Hubot knows about.
- `deploybot help <query>` - Displays all help commands that match <query>.
- `deploybot list assigned roles` - List all assigned roles
- `deploybot semaphoreapp status [<project> [<branch>]]` - Reports build status for projects branches
- `deploybot what roles do I have` - Find out what roles you have
- `deploybot what roles does <user> have` - Find out what roles a user has
- `deploybot who has <role> role` - Find out who has the given role

### AWS Elastic Beanstalk Deploy

TODO
